<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Usuario de Discord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: #5865F2;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .discord-logo {
            text-align: center;
            font-size: 50px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #5865F2;
        }

        button {
            padding: 15px 30px;
            background: #5865F2;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #4752C4;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            color: #5865F2;
            margin: 20px 0;
            display: none;
            font-size: 18px;
        }

        .loading.active {
            display: block;
        }

        .result {
            display: none;
            animation: fadeIn 0.5s;
        }

        .result.active {
            display: block;
        }

        .user-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .banner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 120px;
            object-fit: cover;
            opacity: 0.3;
        }

        .user-content {
            position: relative;
            z-index: 1;
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            border: 5px solid white;
            background: #fff;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .username {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .user-tag {
            opacity: 0.9;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .user-id {
            opacity: 0.8;
            font-size: 14px;
        }

        .badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            backdrop-filter: blur(10px);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 16px;
            color: #333;
            font-weight: 500;
            word-break: break-all;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .error.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-badge {
            background: #5865F2;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 10px;
            margin-left: 10px;
            font-weight: bold;
        }

        .accent-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            border: 2px solid white;
            vertical-align: middle;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="discord-logo">üí¨</div>
        <h1>Buscador de Usuario Discord</h1>

        <div class="search-box">
            <input type="text" id="userId" placeholder="Ingresa el ID del usuario (ej: 123456789012345678)">
            <button onclick="searchUser()">üîç Buscar</button>
        </div>

        <div class="loading" id="loading">‚è≥ Buscando usuario...</div>

        <div class="error" id="error"></div>

        <div class="result" id="result">
            <div class="user-card" id="userCard">
                <img id="bannerImg" class="banner" style="display: none;">
                <div class="user-content">
                    <div class="avatar" id="avatarContainer">
                        <img id="avatarImg" src="" alt="Avatar">
                    </div>
                    <div class="username" id="username">
                        Usuario de Discord
                        <span id="botBadge" class="bot-badge" style="display: none;">BOT</span>
                    </div>
                    <div class="user-tag" id="userTag">@username</div>
                    <div class="user-id" id="displayId">ID: 000000000000000000</div>
                    <div class="badges" id="badges"></div>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Nombre Global</div>
                    <div class="info-value" id="globalName">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Nombre de Usuario</div>
                    <div class="info-value" id="displayUsername">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Cuenta Creada</div>
                    <div class="info-value" id="createdAt">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Tipo de Cuenta</div>
                    <div class="info-value" id="accountType">Usuario</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Color de Acento</div>
                    <div class="info-value" id="accentColor">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Flags P√∫blicos</div>
                    <div class="info-value" id="publicFlags">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BADGE_FLAGS = {
            1: 'üë®‚Äçüíº Discord Staff',
            2: 'üë• Partnered Server Owner',
            4: 'üéâ HypeSquad Events',
            64: 'üè† HypeSquad Bravery',
            128: 'üè† HypeSquad Brilliance',
            256: 'üè† HypeSquad Balance',
            512: 'üêõ Bug Hunter Level 1',
            1024: 'üêõ Bug Hunter Level 2',
            4096: 'üéì Early Supporter',
            16384: 'üîß Verified Bot Developer',
            131072: 'üíé Active Developer'
        };

        async function searchUser() {
            const userId = document.getElementById('userId').value.trim();
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const error = document.getElementById('error');

            loading.classList.remove('active');
            result.classList.remove('active');
            error.classList.remove('active');

            if (!userId) {
                showError('Por favor ingresa un ID de usuario');
                return;
            }

            if (!/^\d{17,19}$/.test(userId)) {
                showError('El ID de Discord debe tener entre 17 y 19 d√≠gitos');
                return;
            }

            loading.classList.add('active');

            try {
                const response = await fetch(`/api/discord-user?userId=${userId}`);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Error al buscar usuario');
                }

                const userData = await response.json();
                displayUserData(userData);
                
            } catch (err) {
                showError(`‚ùå ${err.message}`);
            } finally {
                loading.classList.remove('active');
            }
        }

        function displayUserData(user) {
            const result = document.getElementById('result');
            
            document.getElementById('username').innerHTML = user.global_name || user.username;
            if (user.bot) {
                document.getElementById('botBadge').style.display = 'inline-block';
            } else {
                document.getElementById('botBadge').style.display = 'none';
            }
            
            document.getElementById('userTag').textContent = `@${user.username}`;
            document.getElementById('displayId').textContent = `ID: ${user.id}`;
            document.getElementById('globalName').textContent = user.global_name || 'No establecido';
            document.getElementById('displayUsername').textContent = user.username;
            document.getElementById('createdAt').textContent = getCreationDate(user.id).toLocaleString('es-ES');
            document.getElementById('accountType').textContent = user.bot ? 'Bot' : user.system ? 'Sistema' : 'Usuario';
            document.getElementById('publicFlags').textContent = user.public_flags || '0';

            if (user.avatar) {
                const avatarUrl = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${user.avatar.startsWith('a_') ? 'gif' : 'png'}?size=256`;
                document.getElementById('avatarImg').src = avatarUrl;
            } else {
                const defaultAvatar = (parseInt(user.id) >> 22) % 6;
                document.getElementById('avatarImg').src = `https://cdn.discordapp.com/embed/avatars/${defaultAvatar}.png`;
            }

            if (user.banner) {
                const bannerUrl = `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.${user.banner.startsWith('a_') ? 'gif' : 'png'}?size=600`;
                const bannerImg = document.getElementById('bannerImg');
                bannerImg.src = bannerUrl;
                bannerImg.style.display = 'block';
            } else {
                document.getElementById('bannerImg').style.display = 'none';
            }

            if (user.accent_color) {
                const hexColor = '#' + user.accent_color.toString(16).padStart(6, '0');
                document.getElementById('accentColor').innerHTML = `${hexColor} <span class="accent-color" style="background-color: ${hexColor};"></span>`;
            } else {
                document.getElementById('accentColor').textContent = 'No establecido';
            }

            const badgesContainer = document.getElementById('badges');
            badgesContainer.innerHTML = '';
            if (user.public_flags && user.public_flags > 0) {
                for (const [flag, name] of Object.entries(BADGE_FLAGS)) {
                    if ((user.public_flags & parseInt(flag)) === parseInt(flag)) {
                        const badge = document.createElement('div');
                        badge.className = 'badge';
                        badge.textContent = name;
                        badgesContainer.appendChild(badge);
                    }
                }
            }

            result.classList.add('active');
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.add('active');
        }

        function getCreationDate(userId) {
            const timestamp = Number(BigInt(userId) >> 22n) + 1420070400000;
            return new Date(timestamp);
        }

        document.getElementById('userId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchUser();
            }
        });
    </script>
</body>
</html>